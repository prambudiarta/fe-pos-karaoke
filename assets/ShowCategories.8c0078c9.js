import{Q as C}from"./QBtn.d6aa4958.js";import{Q as F}from"./QInput.b0df898b.js";import{Q as x,a as B}from"./QTable.9cab5d86.js";import{Q as O}from"./QPage.0e392090.js";import{u as I}from"./item-store.9485e393.js";import{S as p}from"./sweetalert2.all.9f9dcfd4.js";import{e as Q,Q as D}from"./firebaseConfig.4f4498d5.js";import{Q as E}from"./QCardActions.8db9fe51.js";import{Q as L}from"./QDialog.6f613d3d.js";import{C as N}from"./ClosePopup.48f5ee19.js";import{_ as U,ak as A,r as s,c as S,w,t as y,v as V,x as m,f as l,A as k,a8 as R,a5 as _,z as j,p as q,o as M,s as P}from"./index.847c9bb9.js";import"./render.6364fbb8.js";import"./QList.57ede4a3.js";import"./QSelect.836893ec.js";import"./use-timeout.602f94f8.js";import"./format.3c3ea85b.js";const T={props:{category:Object,isOpen:Boolean},setup(r,{emit:a}){const{isOpen:c}=A(r),e=s(c.value),n=s({...r.category}),u=S(()=>r.category&&r.category.id),t=s(null),i=s(""),g=s(null),f=s(null),v=I(),h=()=>{g.value.click()},b=()=>{g.value&&g.value.files.length>0&&(f.value=g.value.files[0],n.value.imageUrl=URL.createObjectURL(f.value))};return w(c,d=>{e.value=d}),w(()=>r.isOpen,d=>{d||(URL.revokeObjectURL(i.value),i.value="")}),w(()=>r.category,d=>{n.value={...d}},{deep:!0}),{dialog:e,localCategory:n,isEditMode:u,imagePreviewUrl:i,saveCategory:async()=>{try{u.value?await v.updateCategory(n.value,f.value):await v.saveCategory(n.value,f.value),t.value=null,e.value=!1,a("save")}catch(d){console.error("Error saving category:",d)}},triggerFileInput:h,handleFileChange:b}}},Y={class:"text-h6"},z=["src"];function G(r,a,c,e,n,u){return y(),V(L,{modelValue:e.dialog,"onUpdate:modelValue":a[4]||(a[4]=t=>e.dialog=t)},{default:m(()=>[l(D,null,{default:m(()=>[l(Q,null,{default:m(()=>[k("div",Y,R(e.isEditMode?"Edit Category":"Create Category"),1)]),_:1}),l(Q,null,{default:m(()=>[l(F,{modelValue:e.localCategory.category,"onUpdate:modelValue":a[0]||(a[0]=t=>e.localCategory.category=t),label:"Category Name"},null,8,["modelValue"]),e.localCategory.imageUrl?(y(),_("div",{key:0,class:"q-mt-md",onClick:a[1]||(a[1]=(...t)=>e.triggerFileInput&&e.triggerFileInput(...t))},[k("img",{src:e.localCategory.imageUrl,alt:"Image preview",class:"image-preview"},null,8,z)])):j("",!0),e.localCategory.imageUrl?(y(),_("input",{key:1,type:"file",ref:"fileInput",accept:"image/*",onChange:a[2]||(a[2]=(...t)=>e.handleFileChange&&e.handleFileChange(...t)),hidden:""},null,544)):(y(),_("input",{key:2,type:"file",ref:"fileInput",accept:"image/*",onChange:a[3]||(a[3]=(...t)=>e.handleFileChange&&e.handleFileChange(...t))},null,544))]),_:1}),l(E,{align:"right"},{default:m(()=>[q(l(C,{flat:"",label:"Cancel",color:"primary"},null,512),[[N]]),l(C,{flat:"",label:"Save",color:"primary",onClick:e.saveCategory},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var H=U(T,[["render",G]]);const J={components:{CategoryForm:H},setup(){const r=s(!1),a=I(),c=s([]),e=s(),n=s({}),u=s(""),t=()=>{n.value={},r.value=!0},i=S(()=>u.value?c.value.filter(o=>o.category.toLowerCase().includes(u.value.toLowerCase())):c.value),g=[{name:"category",required:!0,label:"Category",align:"left",field:o=>o.category,sortable:!0},{name:"image",label:"Image",field:"imageUrl",align:"center",sortable:!1},{name:"edit",label:"Action",field:"editAction",align:"center",sortable:!1}],f=async()=>{await a.fetchCategories(),c.value=a.categories},v=o=>{n.value=o,r.value=!0},h=async o=>{await a.updateCategory(o)},b=async o=>{if(typeof o.id=="undefined"){p.fire("Error","Category ID is undefined.","error");return}p.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async d=>{if(d.isConfirmed)if(typeof o.id=="undefined"){p.fire("Error","Category ID is undefined.","error");return}else await a.deleteCategoriy(o.id),await a.fetchCategories(),c.value=a.categories,p.fire("Deleted!","Your item has been deleted.","success")})};return w(()=>{var o;return(o=e.value)==null?void 0:o.dialog},o=>{o===!1&&(r.value=!1)}),M(f),{categories:c,columns:g,categoryForm:e,editableCategory:n,isDialogOpen:r,searchQuery:u,filteredCategory:i,openNewCategoryForm:t,editCategory:v,updateCategory:h,deleteCategory:b,fetchCategories:f}}},K={class:"flex justify-between q-mb-md"};function W(r,a,c,e,n,u){const t=P("category-form");return y(),V(O,{padding:""},{default:m(()=>[k("div",K,[l(C,{label:"Create Categories",color:"primary",onClick:e.openNewCategoryForm,class:"q-mr-md"},null,8,["onClick"]),l(F,{modelValue:e.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=i=>e.searchQuery=i),placeholder:"Search category by name..."},null,8,["modelValue"])]),l(B,{title:"Category List",rows:e.filteredCategory,columns:e.columns,"row-key":"id"},{"body-cell-edit":m(i=>[l(x,{props:i},{default:m(()=>[l(C,{flat:"",icon:"edit",onClick:g=>e.editCategory(i.row)},null,8,["onClick"]),l(C,{flat:"",icon:"delete",onClick:g=>e.deleteCategory(i.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),l(t,{ref:"categoryForm",category:e.editableCategory,isOpen:e.isDialogOpen,onSave:e.updateCategory},null,8,["category","isOpen","onSave"])]),_:1})}var me=U(J,[["render",W]]);export{me as default};
