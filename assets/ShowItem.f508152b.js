import{Q as C}from"./QBtn.05bc70e0.js";import{Q as k}from"./QInput.1ca74760.js";import{Q as U,a as D}from"./QTable.1ce8efe8.js";import{Q as A}from"./QPage.48b772af.js";import{u as O}from"./item-store.6d1ebfb8.js";import{S as b}from"./sweetalert2.all.bbac4cee.js";import{e as F,Q as E}from"./firebaseConfig.3e9e2ba4.js";import{a as L}from"./QSelect.d212bd95.js";import{Q as N}from"./QCardActions.a72f9b7b.js";import{Q as j}from"./QDialog.8d4bab0f.js";import{C as P}from"./ClosePopup.81bbfb03.js";import{_ as S,ak as R,r as n,c as x,w as p,t as y,v as B,x as d,f as o,A as w,a8 as q,a5 as Q,z as M,p as T,o as Y,s as z}from"./index.5079f055.js";import"./render.f2fea035.js";import"./QList.41e64a81.js";import"./use-timeout.b9f1f2b0.js";import"./format.c1433672.js";const G={props:{item:Object,category:Object,isOpen:Boolean},setup(r,{emit:l}){const{isOpen:c}=R(r),e=n(c.value),m=n({...r.item}),f=x(()=>r.item&&r.item.id),t=n(null),i=n(""),u=n(null),g=n(null),v=O(),I=n([]),h=()=>{u.value.click()};console.log("props item"),console.log(r);const _=()=>{u.value&&u.value.files.length>0&&(g.value=u.value.files[0],m.value.imageUrl=URL.createObjectURL(g.value))};return p(()=>r.isOpen,s=>{s||(URL.revokeObjectURL(i.value),i.value="")}),p(c,s=>{e.value=s}),p(()=>r.item,s=>{m.value={...s}},{deep:!0}),p(()=>r.category,s=>{Array.isArray(s)?I.value=s.map(V=>({label:V.category,value:V.id})):I.value=[]},{deep:!0}),{dialog:e,localItem:m,isEditMode:f,selectedImage:t,imagePreviewUrl:i,fileInput:u,localCategoryOptions:I,triggerFileInput:h,handleFileChange:_,saveItem:async()=>{m.value.category=m.value.category.label;try{f.value?await v.updateItem(m.value,g.value):await v.saveItem(m.value,g.value),t.value=null,e.value=!1,l("save")}catch(s){console.error("Error saving item:",s)}}}}},H={class:"text-h6"},J=["src"];function K(r,l,c,e,m,f){return y(),B(j,{modelValue:e.dialog,"onUpdate:modelValue":l[6]||(l[6]=t=>e.dialog=t)},{default:d(()=>[o(E,null,{default:d(()=>[o(F,null,{default:d(()=>[w("div",H,q(e.isEditMode?"Edit Item":"Create Item"),1)]),_:1}),o(F,null,{default:d(()=>[o(k,{modelValue:e.localItem.name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.localItem.name=t),label:"Item Name"},null,8,["modelValue"]),o(k,{modelValue:e.localItem.price,"onUpdate:modelValue":l[1]||(l[1]=t=>e.localItem.price=t),label:"Price",type:"number"},null,8,["modelValue"]),o(L,{modelValue:e.localItem.category,"onUpdate:modelValue":l[2]||(l[2]=t=>e.localItem.category=t),options:e.localCategoryOptions,label:"Category"},null,8,["modelValue","options"]),e.localItem.imageUrl?(y(),Q("div",{key:0,class:"q-mt-md",onClick:l[3]||(l[3]=(...t)=>e.triggerFileInput&&e.triggerFileInput(...t))},[w("img",{src:e.localItem.imageUrl,alt:"Image preview",class:"image-preview"},null,8,J)])):M("",!0),e.localItem.imageUrl?(y(),Q("input",{key:1,type:"file",ref:"fileInput",accept:"image/*",onChange:l[4]||(l[4]=(...t)=>e.handleFileChange&&e.handleFileChange(...t)),hidden:""},null,544)):(y(),Q("input",{key:2,type:"file",ref:"fileInput",accept:"image/*",onChange:l[5]||(l[5]=(...t)=>e.handleFileChange&&e.handleFileChange(...t))},null,544))]),_:1}),o(N,{align:"right"},{default:d(()=>[T(o(C,{flat:"",label:"Cancel",color:"primary"},null,512),[[P]]),o(C,{flat:"",label:"Save",color:"primary",onClick:e.saveItem},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var W=S(G,[["render",K]]);const X={components:{ItemForm:W},setup(){const r=n(!1),l=O(),c=n([]),e=n([]),m=n(),f=n({}),t=n(""),i=()=>{f.value={},r.value=!0},u=x(()=>t.value?c.value.filter(a=>a.name.toLowerCase().includes(t.value.toLowerCase())):c.value),g=[{name:"name",required:!0,label:"Name",align:"left",field:a=>a.name,sortable:!0},{name:"price",label:"Price",field:"price",sortable:!0},{name:"category",label:"Category",field:"category",sortable:!0},{name:"image",label:"Image",field:"imageUrl",align:"center",sortable:!1},{name:"edit",label:"Action",field:"editAction",align:"center",sortable:!1}],v=async()=>{await l.fetchItems(),await l.fetchCategories(),e.value=l.categories,c.value=l.items},I=a=>{f.value=a,r.value=!0},h=async a=>{await l.updateItem(a,null)},_=async a=>{if(typeof a.id=="undefined"){b.fire("Error","Item ID is undefined.","error");return}b.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(async s=>{if(s.isConfirmed)if(typeof a.id=="undefined"){b.fire("Error","Item ID is undefined.","error");return}else await l.deleteItem(a.id),await l.fetchItems(),c.value=l.items,b.fire("Deleted!","Your item has been deleted.","success")})};return p(()=>{var a;return(a=m.value)==null?void 0:a.dialog},a=>{a===!1&&(r.value=!1)}),Y(v),{items:c,columns:g,itemForm:m,editableItem:f,isDialogOpen:r,searchQuery:t,filteredItems:u,categories:e,openNewItemForm:i,editItem:I,updateItem:h,deleteItem:_,fetchItems:v}}},Z={class:"flex justify-between q-mb-md"},$=["src"];function ee(r,l,c,e,m,f){const t=z("item-form");return y(),B(A,{padding:""},{default:d(()=>[w("div",Z,[o(C,{label:"Create Item",color:"primary",onClick:e.openNewItemForm,class:"q-mr-md"},null,8,["onClick"]),o(k,{modelValue:e.searchQuery,"onUpdate:modelValue":l[0]||(l[0]=i=>e.searchQuery=i),placeholder:"Search items by name..."},null,8,["modelValue"])]),o(D,{title:"Items List",rows:e.filteredItems,columns:e.columns,"row-key":"id"},{"body-cell-image":d(i=>[o(U,{props:i},{default:d(()=>[w("img",{src:i.row.imageUrl,alt:"Item Image",height:"50"},null,8,$)]),_:2},1032,["props"])]),"body-cell-edit":d(i=>[o(U,{props:i},{default:d(()=>[o(C,{flat:"",icon:"edit",onClick:u=>e.editItem(i.row)},null,8,["onClick"]),o(C,{flat:"",icon:"delete",onClick:u=>e.deleteItem(i.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),o(t,{ref:"itemForm",item:e.editableItem,category:e.categories,isOpen:e.isDialogOpen,onSave:e.updateItem},null,8,["item","category","isOpen","onSave"])]),_:1})}var pe=S(X,[["render",ee]]);export{pe as default};
