import{Q as u}from"./QBtn.05bc70e0.js";import{a as ve,b as A,Q as S}from"./QTable.1ce8efe8.js";import{c as x,h as ge}from"./render.f2fea035.js";import{c as pe,h as ee,W as ye,_ as we,d as be,t as d,a5 as y,f as l,x as r,F as C,r as c,o as Ce,A as s,a6 as O,v as g,y as b,a8 as f,z as T,p as J,aq as K,ar as L}from"./index.5079f055.js";import{Q as ke}from"./QPage.48b772af.js";import{g as W,c as Y,d as k,a as D,b as R,p as G,Q as $,e as h}from"./firebaseConfig.3e9e2ba4.js";import{f as N,Q as B}from"./use-timeout.b9f1f2b0.js";import{Q as M}from"./QList.41e64a81.js";import{Q as U}from"./QCardActions.a72f9b7b.js";import{Q as E}from"./QDialog.8d4bab0f.js";import{a as Ie}from"./QSelect.d212bd95.js";import{Q as Oe}from"./QInput.1ca74760.js";import{O as X}from"./interfaces.86b2316d.js";import{i as he,g as Se,f as Z}from"./firebaseDateFormatter.c1ec2daf.js";import{S as P}from"./sweetalert2.all.bbac4cee.js";import{u as Te}from"./device-store.0e2e106f.js";import"./format.c1433672.js";var _=x({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:a}){const o=pe(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>ee("tr",{class:o.value},ge(a.default))}});const De=ee("div",{class:"q-space"});var z=x({name:"QSpace",setup(){return()=>De}});const Qe=ye("orderStore",{state:()=>({orders:[],items:[]}),getters:{},actions:{async fetchItems(){const e=await W(Y(k,"items"));this.items=e.docs.map(a=>{const o=a.data();return{id:a.id,name:o.name,price:o.price,category:o.category,imageUrl:o.imageUrl}})},async fetchOrders(){const e=await W(Y(k,"order"));this.orders=e.docs.map(a=>{const o=a.data();return o.itemSummary&&!Array.isArray(o.itemSummary.items)&&(o.itemSummary.items=[o.itemSummary.items]),o}).sort((a,o)=>o.startTime-a.startTime)},async closeOrder(e){const a=D(k,"order",e.orderId),o=D(k,"rooms",e.deviceId);await R(o,{isAvailable:!0});const v=Math.floor(new Date().getTime()/1e3),m=Math.ceil((v-e.startTime)/(60*60)),p=m*e.roomRate;let t=0;e.itemSummary?t=e.itemSummary.totalPrices+p:t=p,await R(a,{status:X.Completed,endTime:v,durationHours:m,roomTotalPrice:p,grandTotalPrice:t})},async createNeworder(e){let a="",o=!1;for(;!o;)a=Se(),o=await he(a);const v=Math.floor(new Date().getTime()/1e3),m={orderId:a,deviceId:e.id,roomRate:e.price,startTime:v,status:X.Ongoing};if(!e.id)throw new Error("Room ID is not set");e.isAvailable=!1;const p=D(k,"rooms",e.id);await G(p,{...e});const t=D(k,"order",a);await G(t,{...m})},async updateOrderItem(e,a){const o=D(k,"order",e);let v=0,m=0;a.forEach(t=>{v+=Number(t.quantity),m+=t.price}),await R(o,{itemSummary:{totalItem:v,totalPrices:m,items:a}})}}});const Pe=be({setup(){const e=Qe(),a=Te(),o=c([]),v=c([]),m=c(!1),p=c([]),t=c({}),i=c([]),q=c(!1),I=c({}),Q=c([]),w=c(null),H=c(!1),j=c([]),V=c({}),te=async n=>{await a.fetchPrinter(),j.value=a.printers,I.value=n,H.value=!0},le=async n=>{I.value=n,await e.fetchItems(),i.value=e.items,n.itemSummary&&(Q.value=n.itemSummary.items),q.value=!0},ae=async()=>{await e.updateOrderItem(I.value.orderId,Q.value),window.location.reload()},re=()=>{if(w.value){const n={itemId:w.value.id,name:w.value.name,quantity:w.value.quantity,price:w.value.price*w.value.quantity};console.log(n),Q.value.push(n),w.value=null}},oe=()=>{q.value=!1,I.value={}},ne=async()=>{await a.fetchRoom(),p.value=a.rooms.filter(n=>n.isAvailable),m.value=!0},se=n=>{t.value=n},ie=async()=>{t.value&&(await e.createNeworder(t.value),await e.fetchOrders(),o.value=e.orders,P.fire("Success","Create Order Sukses!","success"),m.value=!1)},de=[{name:"orderId",align:"left",label:"Order ID",field:"orderId",sortable:!0},{name:"deviceId",align:"left",label:"Device ID",field:"deviceId",sortable:!0},{name:"startTime",align:"left",label:"Start Time",field:n=>Z(n.startTime),sortable:!0},{name:"endTime",align:"left",label:"End Time",field:n=>Z(n.endTime),sortable:!0},{name:"grandTotalPrice",align:"left",label:"Total Price",field:"grandTotalPrice",sortable:!0},{name:"status",align:"left",label:"Status",field:"status",sortable:!0,classes:n=>{switch(n.status){case"completed":return"bg-green";case"ongoing":return"bg-blue";default:return"bg-orange"}}}],F=async()=>{await e.fetchOrders(),o.value=e.orders,console.log(o.value)},ue=n=>{V.value=n},ce=async()=>{try{const n=JSON.parse(JSON.stringify(I.value));console.log(n),window.electronAPI.sendPrintOrder(V.value.id,n)}catch(n){console.log(n)}},me=async n=>{if((await P.fire({title:`Order ${n.orderId}`,text:"Apakah Anda Close Order?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Close Order",cancelButtonText:"Batal"})).isConfirmed)try{await e.closeOrder(n),await e.fetchOrders(),o.value=e.orders,P.fire("Success","Close Order Sukses!","success")}catch(fe){console.error("Error close order:",fe),P.fire("Error","Ada Kendala Saat Close Order.","error")}};return Ce(F),{orders:o,columns:de,expanded:v,openNewOrder:ne,closeOrder:me,fetchOrders:F,printStruck:ce,newOrderDialog:m,rooms:p,selectedRoom:t,selectRoom:se,createOrder:ie,manageItemsDialog:q,currentOrder:I,currentOrderItems:Q,selectedItem:w,items:i,openManageItemsDialog:le,addItemToOrder:re,closeManageItemsDialog:oe,updateItemOrder:ae,printer:j,selectedPrinter:V,openPrintDialog:H,openPrintOrder:te,selectPrinter:ue}}}),_e={class:"flex justify-between row q-mb-md"},qe={class:"flex column q-mr-md"},Ve=s("div",{class:"text-h6 q-mb-md"},"Actions",-1),Ae={class:"text-left"},Re=s("strong",null,"Order:",-1),$e={class:"q-table"},Ne=s("thead",null,[s("tr",null,[s("th",null,"Name"),s("th",null,"Quantity"),s("th",null,"Price")])],-1),Be=s("strong",null,"Total Price:",-1),Me=s("strong",null,"Total Items:",-1),Ue=s("div",{class:"text-h6",style:{"margin-bottom":"20px"}},"Select a Room",-1),Ee=s("div",{class:"text-h6",style:{"margin-bottom":"20px"}},"Select Printer",-1),ze=s("div",{class:"text-h6"},"Manage Items",-1),He={key:0,class:"q-mt-md"},je=s("div",{class:"text-subtitle2"},"Current Items",-1);function Fe(e,a,o,v,m,p){return d(),y(C,null,[l(ke,{padding:""},{default:r(()=>[s("div",_e,[s("div",qe,[Ve,l(u,{label:"Create New Order",color:"primary",onClick:e.openNewOrder,class:"q-mb-md buttonAction"},null,8,["onClick"])])]),l(ve,{title:"Orders",rows:e.orders,columns:e.columns,"row-key":"orderId"},{header:r(t=>[l(_,{props:t},{default:r(()=>[l(A,{"auto-width":""}),(d(!0),y(C,null,O(t.cols,i=>(d(),g(A,{key:i.name,props:t},{default:r(()=>[b(f(i.label),1)]),_:2},1032,["props"]))),128)),l(A,{"auto-width":""},{default:r(()=>[b("Action")]),_:1})]),_:2},1032,["props"])]),body:r(t=>[l(_,{props:t},{default:r(()=>[l(S,null,{default:r(()=>[l(u,{size:"sm",color:"accent",round:"",dense:"",onClick:i=>t.expand=!t.expand,icon:t.expand?"remove":"add"},null,8,["onClick","icon"])]),_:2},1024),(d(!0),y(C,null,O(t.cols,i=>(d(),g(S,{key:i.name,props:t},{default:r(()=>[b(f(i.value),1)]),_:2},1032,["props"]))),128)),l(S,null,{default:r(()=>[l(u,{flat:"",icon:"print",onClick:i=>e.openPrintOrder(t.row)},null,8,["onClick"]),t.row.status!=="completed"?(d(),g(u,{key:0,flat:"",icon:"task_alt",onClick:i=>e.closeOrder(t.row)},null,8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1032,["props"]),t.row.itemSummary?J((d(),g(_,{key:0,props:t},{default:r(()=>[l(S,{colspan:t.cols.length+1},{default:r(()=>[s("div",Ae,[Re,s("table",$e,[Ne,s("tbody",null,[(d(!0),y(C,null,O(t.row.itemSummary.items,i=>(d(),y("tr",{key:i.itemId},[s("td",null,f(i.name),1),s("td",null,f(i.quantity),1),s("td",null,f(i.price),1)]))),128))])]),s("div",null,[Be,b(" "+f(t.row.itemSummary.totalPrices),1)]),s("div",null,[Me,b(" "+f(t.row.itemSummary.totalItem),1)])]),s("div",null,[t.row.endTime?T("",!0):(d(),g(u,{key:0,label:"Add Item",color:"primary",onClick:i=>e.openManageItemsDialog(t.row)},null,8,["onClick"]))])]),_:2},1032,["colspan"])]),_:2},1032,["props"])),[[K,t.expand]]):J((d(),g(_,{key:1},{default:r(()=>[l(S,{colspan:"100%"},{default:r(()=>[t.row.endTime?T("",!0):(d(),g(u,{key:0,label:"Add Item",color:"primary",onClick:i=>e.openManageItemsDialog(t.row)},null,8,["onClick"]))]),_:2},1024)]),_:2},1536)),[[K,t.expand]])]),_:1},8,["rows","columns"])]),_:1}),l(E,{modelValue:e.newOrderDialog,"onUpdate:modelValue":a[2]||(a[2]=t=>e.newOrderDialog=t),persistent:""},{default:r(()=>[l($,null,{default:r(()=>[l(h,{class:"row items-center"},{default:r(()=>[l(z),l(u,{icon:"close",flat:"",round:"",onClick:a[0]||(a[0]=t=>e.newOrderDialog=!1)})]),_:1}),l(h,null,{default:r(()=>[Ue,l(M,null,{default:r(()=>[(d(!0),y(C,null,O(e.rooms,t=>(d(),g(B,{key:t.id,clickable:"",class:L({"selected-room":e.selectedRoom===t}),onClick:i=>e.selectRoom(t)},{default:r(()=>[l(N,null,{default:r(()=>[b(f(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),l(U,{align:"right"},{default:r(()=>[l(u,{flat:"",label:"Cancel",color:"negative",onClick:a[1]||(a[1]=t=>e.newOrderDialog=!1)}),l(u,{flat:"",label:"Create Order",color:"primary",onClick:e.createOrder,disabled:!e.selectedRoom},null,8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:e.openPrintDialog,"onUpdate:modelValue":a[5]||(a[5]=t=>e.openPrintDialog=t),persistent:""},{default:r(()=>[l($,null,{default:r(()=>[l(h,{class:"row items-center"},{default:r(()=>[l(z),l(u,{icon:"close",flat:"",round:"",onClick:a[3]||(a[3]=t=>e.openPrintDialog=!1)})]),_:1}),l(h,null,{default:r(()=>[Ee,l(M,null,{default:r(()=>[(d(!0),y(C,null,O(e.printer,t=>(d(),g(B,{key:t.id,clickable:"",class:L({"selected-printer":e.selectedPrinter===t}),onClick:i=>e.selectPrinter(t)},{default:r(()=>[l(N,null,{default:r(()=>[b(f(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),l(U,{align:"right"},{default:r(()=>[l(u,{flat:"",label:"Cancel",color:"negative",onClick:a[4]||(a[4]=t=>e.openPrintDialog=!1)}),l(u,{flat:"",label:"Print",color:"primary",onClick:e.printStruck,disabled:!e.selectedRoom},null,8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:e.manageItemsDialog,"onUpdate:modelValue":a[8]||(a[8]=t=>e.manageItemsDialog=t)},{default:r(()=>[l($,null,{default:r(()=>[l(h,{class:"row items-center"},{default:r(()=>[ze,l(z),l(u,{icon:"close",flat:"",round:"",onClick:e.closeManageItemsDialog},null,8,["onClick"])]),_:1}),l(h,null,{default:r(()=>[s("div",null,[l(Ie,{modelValue:e.selectedItem,"onUpdate:modelValue":a[6]||(a[6]=t=>e.selectedItem=t),label:"Select Item",options:e.items,"option-value":"id","option-label":"name",class:"q-mb-md",placeholder:"Choose an item"},null,8,["modelValue","options"]),e.selectedItem?(d(),g(Oe,{key:0,type:"number",modelValue:e.selectedItem.quantity,"onUpdate:modelValue":a[7]||(a[7]=t=>e.selectedItem.quantity=t),label:"Quantity",class:"q-mb-md"},null,8,["modelValue"])):T("",!0),l(u,{label:"Add Item",onClick:e.addItemToOrder,color:"primary"},null,8,["onClick"])]),e.currentOrderItems.length>0?(d(),y("div",He,[je,l(M,{bordered:""},{default:r(()=>[(d(!0),y(C,null,O(e.currentOrderItems,(t,i)=>(d(),g(B,{key:i},{default:r(()=>[l(N,null,{default:r(()=>[b(f(t.name)+" - "+f(t.quantity)+" - Rp. "+f(t.price),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):T("",!0)]),_:1}),l(U,{align:"right"},{default:r(()=>[l(u,{flat:"",label:"Update",onClick:e.updateItemOrder},null,8,["onClick"]),l(u,{flat:"",label:"Close",onClick:e.closeManageItemsDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var dt=we(Pe,[["render",Fe]]);export{dt as default};
